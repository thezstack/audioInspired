<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/addons/p5.sound.js"></script>
  </head>
  <body>
    <main></main>
  </body>

  <script>
  function preload(){
  sound = loadSound('lofi2.ogg');
}

var url = "http://colormind.io/api/";
var data = {
	model : "default",
	input : [[44,43,44],[90,83,82],"N","N","N"]
}

var http = new XMLHttpRequest();
var palette = [];
http.onreadystatechange = function() {
	if(http.readyState == 4 && http.status == 200) {
   palette = JSON.parse(http.responseText).result;
  
	}
}

http.open("POST", url, true);
http.send(JSON.stringify(data));

function setup(){
  let cnv = createCanvas(800,800);
  cnv.mouseClicked(togglePlay);


  fft = new p5.FFT();
  sound.amp(0.2);

}

function draw(){

  let spectrum = fft.analyze();
  
  let colorX = map(mouseX, 0 , 800, 0, 255);
  let colorY = map(mouseY, 0 , 800, 255,0 );
  background(colorX ,colorY, 245);
  stroke(94, 252, 141);
  strokeWeight(5);
  fill(131, 119, 209);
  let randomX = random(300,800);
  let randomY = random(300,800);
  for (let i = 0; i< spectrum.length; i++){
    let x = map(i, 0, spectrum.length, 0, width);
    let h = -height + map(spectrum[i], 0, 255, height, 0);
    // rect(x, height, width / spectrum.length, h )
    // ellipse(x, height, width/spectrum.length, h);
      // ellipseMode(CENTER);
     ellipse(mouseX ,mouseY ,h);  
        // rect(100, 300, x, h);
  }

  let waveform = fft.waveform();
  noStroke();

  fill(43, 61, 65);
  for (let i = 0; i < waveform.length; i++){
    let x = map(i, 0, waveform.length, 0, width);
    let y = map( waveform[i], -1, 1, 0, height);
    // vertex(x,y);
    // ellipse(waveform[i],waveform[i + 1],10);
    // console.log(waveform[i]);
  }
  endShape();

  text('tap to play', 20, 20);
}

function togglePlay() {
  if (sound.isPlaying()) {
    sound.pause();
  } else {
    sound.loop();
  }
}

// function mousePressed(){
//   background(250,250,100);
// }
  </script>
</html>
